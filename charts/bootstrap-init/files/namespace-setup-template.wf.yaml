---
# Example inline json for namespaces parameter
#  [
#   { "name": "test", "labels": {"iam": "working", "soami": "yes"},"annotations": { "my": "annotation"}},
#   { "name": "test2", "labels": { "istio-injection": "enabled"}, "annotations": { "my": "annotation"}},
#   { "name": "test3", "labels": { "istio-injection": "enabled"}, "annotations": {}} 
#  ]

apiVersion: argoproj.io/v1alpha1
kind: WorkflowTemplate
metadata:
  name: namespace-template
spec:
  entrypoint: namespace-entrypoint
  securityContext:
    runAsNonRoot: true
    runAsUser: 10010
  arguments:
    parameters:
      - name: namespaces
        value: |
          []

############# Workflow Definition #################
  templates:
  - name: namespace-entrypoint
    steps:
    - - name: create-namespace
        template: namespace
        arguments:
          parameters:
          - name: name
            value: "{{item.name}}"
          - name: labels
            value: "{{item.labels}}"
          - name: annotations
            value: "{{item.annotations}}"
        withParam: "{{workflow.parameters.namespaces}}"

############# Workflow Step Definitions #################

  - name: namespace
    inputs:
      parameters:
      - name: name
      - name: labels
      - name: annotations
    resource:
      action: apply
      manifest: |
        apiVersion: v1
        kind: Namespace
        metadata:
          name: {{inputs.parameters.name}}
          labels:
            {{inputs.parameters.labels}}
          annotations:
            {{inputs.parameters.annotations}}
