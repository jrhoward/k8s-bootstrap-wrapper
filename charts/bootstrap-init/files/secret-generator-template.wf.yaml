---
apiVersion: argoproj.io/v1alpha1
kind: WorkflowTemplate
metadata:
  name: secrets
  annotations:
    "helm.sh/hook": post-install,post-upgrade
    "helm.sh/hook-weight": "150"
    #"helm.sh/hook-delete-policy": before-hook-creation
spec:
  entrypoint: secrets
  securityContext:
    runAsNonRoot: true
    runAsUser: 10010
  arguments:
    parameters:
      - name: name
        value: ""
      - name: key
        value: ""
      - name: namespaces
        value: |
          []
  templates:
    - name: secrets
      steps:
      - - name: secrets
          resource:
            action: apply
            manifest: |
              apiVersion: v1
              kind: Secret
              metadata:
                name: {{{workflow.parameters.name}}
                namespace: {{ item }}
              type: Opaque
              stringData:
                {{workflow.parameters.key}}: 
          withParam: "{{workflow.parameters.namespaces}}"
